<!DOCTYPE html>
<html>
<head>
  <title>Kids' Math Adventure – Super Educational Edition</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: linear-gradient(135deg, #ffd1dc, #c1ff72, #87ceeb);
      font-family: 'Comic Sans MS', cursive;
    }
    #gameContainer {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    #ui {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #fff;
      font-size: 36px;
      text-shadow: 0 0 8px #ff4081, 0 0 15px #ff4081;
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 20px;
      border: 4px solid #ffeb3b;
    }
    #question {
      font-size: 64px;
      margin-bottom: 10px;
    }
    #feedback {
      font-size: 32px;
      color: #ffeb3b;
      margin-top: 10px;
    }
    #score, #stars {
      font-size: 36px;
    }
    #modeSelector {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 15px;
    }
    .mode-button {
      width: 100px;
      height: 100px;
      font-size: 24px;
      background: linear-gradient(135deg, #ffeb3b, #ff9800);
      border: none;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 0 8px #ff5722;
      transition: all 0.2s;
    }
    .mode-button:hover {
      transform: scale(1.1);
    }
    .mode-button:active {
      box-shadow: 0 4px #ff5722;
      transform: translateY(4px);
    }
    .mode-button.selected {
      background: linear-gradient(135deg, #4caf50, #8bc34a);
      box-shadow: 0 8px #388e3c;
    }
    #calculator {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 25px;
      box-shadow: 0 0 40px rgba(255, 235, 59, 1);
    }
    #display {
      width: 350px;
      height: 90px;
      font-size: 48px;
      text-align: right;
      padding: 15px;
      margin-bottom: 20px;
      border: 4px solid #ff4081;
      border-radius: 10px;
      background: #fff;
      box-shadow: inset 0 0 10px #000;
    }
    .button-row {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }
    .calc-button {
      width: 90px;
      height: 90px;
      font-size: 40px;
      font-family: 'Comic Sans MS', cursive;
      background: linear-gradient(135deg, #ffeb3b, #ff4081);
      border: none;
      border-radius: 20px;
      cursor: pointer;
      box-shadow: 0 10px #e91e63;
      transition: all 0.2s;
    }
    .calc-button:hover {
      background: linear-gradient(135deg, #ff4081, #ffeb3b);
      transform: scale(1.05);
    }
    .calc-button:active {
      box-shadow: 0 5px #e91e63;
      transform: translateY(5px);
    }
    #submit, #hint {
      background: linear-gradient(135deg, #4caf50, #8bc34a);
      width: 150px;
      font-size: 36px;
    }
    #submit:hover, #hint:hover {
      background: linear-gradient(135deg, #8bc34a, #4caf50);
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <div id="ui">
      <div id="question">3 × 4 = ?</div>
      <div id="score">Score: 0</div>
      <div id="stars">Stars: ★ 0</div>
      <div id="feedback"></div>
    </div>
    <div id="modeSelector">
      <button class="mode-button" onclick="setMode('add')">+</button>
      <button class="mode-button" onclick="setMode('sub')">−</button>
      <button class="mode-button" onclick="setMode('mul')">×</button>
    </div>
    <div id="calculator">
      <input type="text" id="display" readonly>
      <div class="button-row">
        <button class="calc-button" onclick="appendNumber('1')">1</button>
        <button class="calc-button" onclick="appendNumber('2')">2</button>
        <button class="calc-button" onclick="appendNumber('3')">3</button>
      </div>
      <div class="button-row">
        <button class="calc-button" onclick="appendNumber('4')">4</button>
        <button class="calc-button" onclick="appendNumber('5')">5</button>
        <button class="calc-button" onclick="appendNumber('6')">6</button>
      </div>
      <div class="button-row">
        <button class="calc-button" onclick="appendNumber('7')">7</button>
        <button class="calc-button" onclick="appendNumber('8')">8</button>
        <button class="calc-button" onclick="appendNumber('9')">9</button>
      </div>
      <div class="button-row">
        <button class="calc-button" onclick="appendNumber('0')">0</button>
        <button class="calc-button" onclick="clearDisplay()">C</button>
        <button id="hint" class="calc-button" onclick="showHint()">Hint</button>
        <button id="submit" class="calc-button" onclick="checkAnswer()">Submit</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script>
    // Three.js Setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById("gameContainer").appendChild(renderer.domElement);

    // Background
    const sphereGeometry = new THREE.SphereGeometry(500, 32, 32);
    const sphereMaterial = new THREE.MeshBasicMaterial({ color: 0x1a2a1a, side: THREE.BackSide });
    const backgroundSphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
    scene.add(backgroundSphere);

    // Happy/Sad Face (Star)
    const faceGroup = new THREE.Group();
    const starGeometry = new THREE.SphereGeometry(60, 32, 32);
    const starMaterial = new THREE.MeshBasicMaterial({ color: 0xffeb3b });
    const star = new THREE.Mesh(starGeometry, starMaterial);
    faceGroup.add(star);

    const eyeGeometry = new THREE.SphereGeometry(10, 16, 16);
    const eyeMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
    const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
    leftEye.position.set(-20, 15, 50);
    const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
    rightEye.position.set(20, 15, 50);
    faceGroup.add(leftEye, rightEye);

    let mouth;
    function updateMouth(isHappy) {
      if (mouth) faceGroup.remove(mouth);
      const mouthGeometry = new THREE.ShapeGeometry(
        isHappy ? drawSmile() : drawFrown()
      );
      const mouthMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
      mouth = new THREE.Mesh(mouthGeometry, mouthMaterial);
      mouth.position.set(0, -15, 50);
      faceGroup.add(mouth);
    }
    function drawSmile() {
      const shape = new THREE.Shape();
      shape.moveTo(-20, 0);
      shape.quadraticCurveTo(0, -20, 20, 0);
      return shape;
    }
    function drawFrown() {
      const shape = new THREE.Shape();
      shape.moveTo(-20, 0);
      shape.quadraticCurveTo(0, 20, 20, 0);
      return shape;
    }
    updateMouth(true);

    faceGroup.position.set(
      window.innerWidth / 4 - 60,
      60,
      -window.innerHeight / 4 + 60
    );
    scene.add(faceGroup);

    // Hint Stars
    let hintStars = [];
    function showHint() {
      hintStars.forEach(s => scene.remove(s));
      hintStars = [];
      const count = operation === "×" ? num1 * num2 : operation === "+" ? num1 + num2 : num1;
      for (let i = 0; i < count; i++) {
        const geometry = new THREE.SphereGeometry(5, 16, 16);
        const material = new THREE.MeshBasicMaterial({ color: 0xff4081 });
        const star = new THREE.Mesh(geometry, material);
        star.position.set(
          -100 + (i % 5) * 40,
          100 - Math.floor(i / 5) * 40,
          0
        );
        hintStars.push(star);
        scene.add(star);
      }
      setTimeout(() => {
        hintStars.forEach(s => scene.remove(s));
        hintStars = [];
      }, 3000);
    }

    // Lighting
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.6);
    directionalLight.position.set(0, 50, 50);
    scene.add(directionalLight);

    // Camera
    camera.position.set(0, 150, 300);
    camera.lookAt(0, 0, 0);

    // Particle System
    let particles = [];
    function createParticles(x, y, z, color) {
      const particleCount = 40;
      for (let i = 0; i < particleCount; i++) {
        const geometry = new THREE.SphereGeometry(Math.random() * 3 + 2);
        const material = new THREE.MeshBasicMaterial({ color });
        const particle = new THREE.Mesh(geometry, material);
        particle.position.set(x, y, z);
        particles.push({
          mesh: particle,
          vx: (Math.random() - 0.5) * 6,
          vy: Math.random() * 6,
          vz: (Math.random() - 0.5) * 6,
          alpha: 1
        });
        scene.add(particle);
      }
    }
    function updateParticles() {
      particles = particles.filter(p => {
        p.mesh.position.x += p.vx;
        p.mesh.position.y += p.vy;
        p.mesh.position.z += p.vz;
        p.vy -= 0.15;
        p.alpha -= 0.015;
        p.mesh.material.opacity = p.alpha;
        if (p.alpha <= 0) scene.remove(p.mesh);
        return p.alpha > 0;
      });
    }

    // Game Logic
    let score = 0;
    let starsEarned = 0;
    let num1, num2, operation, correctAnswer;
    let mode = "add"; // Default mode
    function generateQuestion() {
      num1 = Math.floor(Math.random() * (score < 10 ? 5 : 9)) + 1; // 1-5 initially, then 1-9
      num2 = Math.floor(Math.random() * (score < 10 ? 5 : 9)) + 1;
      operation = mode === "add" ? "+" : mode === "sub" ? "-" : "×";
      if (operation === "+") correctAnswer = num1 + num2;
      else if (operation === "-") {
        num1 = Math.max(num1, num2); // Ensure non-negative
        num2 = Math.min(num1, num2);
        correctAnswer = num1 - num2;
      } else correctAnswer = num1 * num2;
      document.getElementById("question").textContent = `${num1} ${operation} ${num2} = ?`;
    }
    generateQuestion();

    let inputValue = "";
    function appendNumber(num) {
      inputValue += num;
      document.getElementById("display").value = inputValue;
    }
    function clearDisplay() {
      inputValue = "";
      document.getElementById("display").value = "";
    }
    function checkAnswer() {
      const userAnswer = parseInt(inputValue);
      if (userAnswer === correctAnswer) {
        score++;
        starsEarned++;
        document.getElementById("score").textContent = `Score: ${score}`;
        document.getElementById("stars").textContent = `Stars: ★ ${starsEarned}`;
        document.getElementById("feedback").textContent = "Great Job!";
        updateMouth(true);
        createParticles(faceGroup.position.x, faceGroup.position.y, faceGroup.position.z, 0xffff00);
        generateQuestion();
        clearDisplay();
      } else {
        document.getElementById("feedback").textContent = "Try Again!";
        updateMouth(false);
        let shake = 0;
        const shakeInterval = setInterval(() => {
          faceGroup.rotation.z = Math.sin(shake++ * 0.5) * 0.3;
          if (shake > 20) {
            clearInterval(shakeInterval);
            faceGroup.rotation.z = 0;
          }
        }, 50);
      }
    }

    // Mode Selection
    const modeButtons = document.querySelectorAll(".mode-button");
    function setMode(newMode) {
      mode = newMode;
      modeButtons.forEach(btn => btn.classList.remove("selected"));
      if (newMode === "add") modeButtons[0].classList.add("selected");
      else if (newMode === "sub") modeButtons[1].classList.add("selected");
      else modeButtons[2].classList.add("selected");
      generateQuestion();
      clearDisplay();
    }
    modeButtons[0].classList.add("selected"); // Default to addition

    // Animation Loop
    function animate() {
      requestAnimationFrame(animate);
      backgroundSphere.rotation.y += 0.002;
      updateParticles();
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
