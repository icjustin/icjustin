<!DOCTYPE html>
<html>
<head>
  <title>Kids' Calculator Game – Happy/Sad Face Edition</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: linear-gradient(135deg, #ffcccb, #b2ff59, #80deea);
      font-family: 'Comic Sans MS', cursive;
    }
    #gameContainer {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    #ui {
      position: absolute;
      top: 30px;
      left: 30px;
      color: #fff;
      font-size: 40px;
      text-shadow: 0 0 10px #ffeb3b, 0 0 20px #ffeb3b;
      background: rgba(0, 0, 0, 0.6);
      padding: 25px;
      border-radius: 20px;
      border: 4px solid #ffeb3b;
    }
    #question {
      font-size: 60px;
      margin-bottom: 15px;
    }
    #score {
      font-size: 40px;
    }
    #calculator {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 25px;
      box-shadow: 0 0 30px rgba(255, 235, 59, 0.9);
    }
    #display {
      width: 300px;
      height: 80px;
      font-size: 40px;
      text-align: right;
      padding: 15px;
      margin-bottom: 20px;
      border: 4px solid #ffeb3b;
      border-radius: 10px;
      background: #fff;
      box-shadow: inset 0 0 10px #000;
    }
    .button-row {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }
    .calc-button {
      width: 80px;
      height: 80px;
      font-size: 36px;
      font-family: 'Comic Sans MS', cursive;
      background: linear-gradient(135deg, #ffeb3b, #ff4081);
      border: none;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 0 8px #e91e63;
      transition: all 0.2s;
    }
    .calc-button:hover {
      background: linear-gradient(135deg, #ff4081, #ffeb3b);
      transform: scale(1.05);
    }
    .calc-button:active {
      box-shadow: 0 4px #e91e63;
      transform: translateY(4px);
    }
    #submit {
      background: linear-gradient(135deg, #4caf50, #8bc34a);
      width: 150px;
      font-size: 36px;
    }
    #submit:hover {
      background: linear-gradient(135deg, #8bc34a, #4caf50);
    }
    #starBuddy {
      position: absolute;
      top: 30px;
      right: 30px;
      width: 100px;
      height: 100px;
      background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTUwIDUwTDY1IDMwTDcwIDQ1TDg1IDUwTDcwIDU1LDY1IDcwTDUwIDg1TDM1IDcwTDMwIDU1TDIwIDUwTDM1IDQ1TDM1IDMwWiIgZmlsbD0iI2ZmZWIzYiIgc3Ryb2tlPSIjZmY0MDgxIiBzdHJva2Utd2lkdGg9IjQiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI4IiBmaWxsPSIjMDAwIi8+PGRhdGEgbmFtZT0iU21pbGV5IiBmaWxsPSIjMDAwIiBkPSJNNTAgNjBBNCA0IDAgMCAxIDQ2IDY0IDQgNCAwIDAgMSA1MCA2OFoiLz48L3N2Zz4=') no-repeat center;
      background-size: contain;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <div id="ui">
      <div id="question">3 × 4 = ?</div>
      <div id="score">Score: 0</div>
    </div>
    <div id="starBuddy"></div>
    <div id="calculator">
      <input type="text" id="display" readonly>
      <div class="button-row">
        <button class="calc-button" onclick="appendNumber('1')">1</button>
        <button class="calc-button" onclick="appendNumber('2')">2</button>
        <button class="calc-button" onclick="appendNumber('3')">3</button>
      </div>
      <div class="button-row">
        <button class="calc-button" onclick="appendNumber('4')">4</button>
        <button class="calc-button" onclick="appendNumber('5')">5</button>
        <button class="calc-button" onclick="appendNumber('6')">6</button>
      </div>
      <div class="button-row">
        <button class="calc-button" onclick="appendNumber('7')">7</button>
        <button class="calc-button" onclick="appendNumber('8')">8</button>
        <button class="calc-button" onclick="appendNumber('9')">9</button>
      </div>
      <div class="button-row">
        <button class="calc-button" onclick="appendNumber('0')">0</button>
        <button class="calc-button" onclick="clearDisplay()">C</button>
        <button id="submit" class="calc-button" onclick="checkAnswer()">Submit</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script>
    // Three.js Setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById("gameContainer").appendChild(renderer.domElement);

    // Background (rotating sphere with sparkles)
    const sphereGeometry = new THREE.SphereGeometry(500, 32, 32);
    const sphereMaterial = new THREE.MeshBasicMaterial({ color: 0x1a2a1a, side: THREE.BackSide });
    const backgroundSphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
    scene.add(backgroundSphere);

    // Happy/Sad Face (Star)
    const faceGroup = new THREE.Group();
    const starGeometry = new THREE.SphereGeometry(50, 32, 32); // Larger star
    const starMaterial = new THREE.MeshBasicMaterial({ color: 0xffeb3b });
    const star = new THREE.Mesh(starGeometry, starMaterial);
    faceGroup.add(star);

    // Eyes
    const eyeGeometry = new THREE.SphereGeometry(8, 16, 16);
    const eyeMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
    const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
    leftEye.position.set(-15, 10, 40);
    const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
    rightEye.position.set(15, 10, 40);
    faceGroup.add(leftEye, rightEye);

    // Mouth (dynamic)
    let mouth;
    function updateMouth(isHappy) {
      if (mouth) faceGroup.remove(mouth);
      const mouthGeometry = new THREE.ShapeGeometry(
        isHappy ? drawSmile() : drawFrown()
      );
      const mouthMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
      mouth = new THREE.Mesh(mouthGeometry, mouthMaterial);
      mouth.position.set(0, -10, 40);
      faceGroup.add(mouth);
    }
    function drawSmile() {
      const shape = new THREE.Shape();
      shape.moveTo(-15, 0);
      shape.quadraticCurveTo(0, -15, 15, 0);
      return shape;
    }
    function drawFrown() {
      const shape = new THREE.Shape();
      shape.moveTo(-15, 0);
      shape.quadraticCurveTo(0, 15, 15, 0);
      return shape;
    }
    updateMouth(true); // Start happy

    faceGroup.position.set(
      window.innerWidth / 4 - 50, // Bottom-right X (adjusted for camera)
      50,                        // Y
      -window.innerHeight / 4    // Bottom-right Z
    );
    scene.add(faceGroup);

    // Lighting
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.6);
    directionalLight.position.set(0, 50, 50);
    scene.add(directionalLight);

    // Camera
    camera.position.set(0, 150, 300);
    camera.lookAt(0, 0, 0);

    // Particle System for Feedback
    let particles = [];
    function createParticles(x, y, z, color) {
      const particleCount = 40;
      for (let i = 0; i < particleCount; i++) {
        const geometry = new THREE.SphereGeometry(Math.random() * 3 + 2);
        const material = new THREE.MeshBasicMaterial({ color });
        const particle = new THREE.Mesh(geometry, material);
        particle.position.set(x, y, z);
        particles.push({
          mesh: particle,
          vx: (Math.random() - 0.5) * 6,
          vy: Math.random() * 6,
          vz: (Math.random() - 0.5) * 6,
          alpha: 1
        });
        scene.add(particle);
      }
    }
    function updateParticles() {
      particles = particles.filter(p => {
        p.mesh.position.x += p.vx;
        p.mesh.position.y += p.vy;
        p.mesh.position.z += p.vz;
        p.vy -= 0.15;
        p.alpha -= 0.015;
        p.mesh.material.opacity = p.alpha;
        if (p.alpha <= 0) scene.remove(p.mesh);
        return p.alpha > 0;
      });
    }

    // Game Logic
    let score = 0;
    let num1, num2, operation, correctAnswer;
    function generateQuestion() {
      num1 = Math.floor(Math.random() * 9) + 1; // 1-9
      num2 = Math.floor(Math.random() * 9) + 1; // 1-9
      const ops = ["+", "-", "×"];
      operation = ops[Math.floor(Math.random() * ops.length)];
      if (operation === "+") correctAnswer = num1 + num2;
      else if (operation === "-") correctAnswer = num1 - num2;
      else correctAnswer = num1 * num2;
      document.getElementById("question").textContent = `${num1} ${operation} ${num2} = ?`;
    }
    generateQuestion();

    let inputValue = "";
    function appendNumber(num) {
      inputValue += num;
      document.getElementById("display").value = inputValue;
    }
    function clearDisplay() {
      inputValue = "";
      document.getElementById("display").value = "";
    }
    function checkAnswer() {
      const userAnswer = parseInt(inputValue);
      if (userAnswer === correctAnswer) {
        score++;
        document.getElementById("score").textContent = `Score: ${score}`;
        updateMouth(true); // Happy face
        createParticles(faceGroup.position.x, faceGroup.position.y, faceGroup.position.z, 0xffff00);
        generateQuestion();
        clearDisplay();
      } else {
        updateMouth(false); // Sad face
        let shake = 0;
        const shakeInterval = setInterval(() => {
          faceGroup.rotation.z = Math.sin(shake++ * 0.5) * 0.3;
          if (shake > 20) {
            clearInterval(shakeInterval);
            faceGroup.rotation.z = 0;
          }
        }, 50);
      }
    }

    // Animation Loop
    function animate() {
      requestAnimationFrame(animate);
      backgroundSphere.rotation.y += 0.002;
      updateParticles();
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
